{"version":3,"file":"create-federate-action.js","sourceRoot":"","sources":["../../src/listeners/create-federate-action.ts"],"names":[],"mappings":";;;;;AAYA,oDAgCC;AA3CD,wDAAgC;AAEhC,uDAAgD;AAChD;;;;;;;GAOG;AACH,SAAgB,oBAAoB,CAAC,MAAsB,EAAE,SAAiB;IAC5E,OAAO,UAAS,QAA0B;QACxC,sCAAsC;QACtC,QAAQ,CAAC,EAAE,CAAC,kBAAkB,EAAE,KAAK,EAAE,KAAK,EAAE,EAAE;;YAC9C,MAAM,EAAE,OAAO,EAAE,EAAC,UAAU,EAAE,OAAO,EAAE,EAAE,GAAG,KAAK,CAAC;YAElD,0CAA0C;YAC1C,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,MAAM,aAAG,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YAE/D,mFAAmF;YACnF,IAAI,QAAQ,CAAC,IAAI,KAAK,MAAM,CAAC,oBAAoB,EAAE,CAAC;gBAClD,IAAI,MAAM,CAAC,KAAK;oBAAE,IAAA,qBAAO,EAAC,oBAAoB,EAAE,0CAA0C,QAAQ,CAAC,IAAI,GAAG,CAAC,CAAC;gBAC5G,8DAA8D;gBAC9D,MAAM,aAAG,CAAC,OAAO,CAAC,MAAM,CAAC;oBACvB,OAAO,EAAE,OAAO;oBAChB,IAAI,EAAE;wBACJ,QAAQ,EAAE,UAAU,EAAoC,+CAA+C;wBACvG,SAAS,EAAE,SAAS,EAAoC,0CAA0C;wBAClG,IAAI,EAAE,CAAA,MAAA,MAAM,CAAC,MAAM,0CAAE,IAAI,KAAI,YAAY,EAAe,oCAAoC;wBAC5F,KAAK,EAAE,CAAA,MAAA,MAAM,CAAC,MAAM,0CAAE,KAAK,KAAI,kBAAkB,EAAM,+BAA+B;wBACtF,OAAO,EAAE,MAAA,MAAA,MAAM,CAAC,MAAM,0CAAE,OAAO,mCAAI,IAAI,EAAiB,mCAAmC;wBAC3F,WAAW,EAAE,CAAA,MAAA,MAAM,CAAC,MAAM,0CAAE,WAAW,KAAI,4CAA4C,EAAG,qBAAqB;wBAC/G,OAAO,EAAE,MAAA,MAAA,MAAM,CAAC,MAAM,0CAAE,OAAO,mCAAI,IAAI,EAAiB,sCAAsC;wBAC9F,KAAK,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAA6B,qCAAqC;qBAC9F;iBACF,CAAC,CAAA;gBACF,IAAI,MAAM,CAAC,KAAK;oBAAE,IAAA,qBAAO,EAAC,oBAAoB,EAAE,yCAAyC,QAAQ,CAAC,IAAI,GAAG,CAAC,CAAC;YAC7G,CAAC;iBAAM,CAAC;gBACN,IAAI,MAAM,CAAC,KAAK;oBAAE,IAAA,qBAAO,EAAC,oBAAoB,EAAE,sDAAsD,QAAQ,CAAC,IAAI,GAAG,CAAC,CAAC;YAC1H,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC,CAAA;AACH,CAAC","sourcesContent":["import { FlatfileListener } from \"@flatfile/listener\";\nimport api from \"@flatfile/api\";\nimport { FederateConfig } from \"../types\";\nimport { logInfo } from \"@flatfile/util-common\";\n/**\n * Creates a function that sets up a listener for workbook creation events\n * and creates a federate action on the specified source workbook\n * \n * @param config - Configuration object containing settings for the federate action\n * @param operation - The operation identifier for the federate action\n * @returns A function that takes a FlatfileListener and sets up the workbook creation event handler\n */\nexport function createFederateAction(config: FederateConfig, operation: string) {\n  return function(listener: FlatfileListener) {\n    // Listen for workbook creation events\n    listener.on(\"workbook:created\", async (event) => {\n      const { context: {workbookId, spaceId } } = event;\n      \n      // Get the details of the created workbook\n      const { data: workbook } = await api.workbooks.get(workbookId);\n      \n      // Only create the federate action if this is the source workbook we're looking for\n      if (workbook.name === config.source_workbook_name) {\n        if (config.debug) logInfo(`ðŸ“¦ Federate Plugin`, `Creating federate action for workbook \"${workbook.name}\"`);\n        // Create the federate action with the specified configuration\n        await api.actions.create({\n          spaceId: spaceId,\n          body: {\n            targetId: workbookId,                                   // The workbook this action will be attached to\n            operation: operation,                                   // The operation identifier for the action\n            mode: config.action?.mode || \"foreground\",              // How the action should be executed\n            label: config.action?.label || \"ðŸ“¦ â€ƒFEDERATEâ€ƒ ðŸ“¦\",     // Display label for the action\n            primary: config.action?.primary ?? true,                // Whether this is a primary action\n            description: config.action?.description || \"Create Federated Workbook with source data\",  // Action description\n            confirm: config.action?.confirm ?? true,                // Whether to show confirmation dialog\n            mount: { type: \"workbook\" },                            // Mount the action at workbook level\n          }\n        })\n        if (config.debug) logInfo(`ðŸ“¦ Federate Plugin`, `Federate action created for workbook \"${workbook.name}\"`);\n      } else {\n        if (config.debug) logInfo(`ðŸ“¦ Federate Plugin`, `Skipping creation of federate action for workbook \"${workbook.name}\"`);\n      }\n    });\n  }\n} "]}